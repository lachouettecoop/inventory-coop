version: '3.5'

services:
  db:
    image: mongo
    restart: unless-stopped
    ports:
      - 27017:27017
    env_file:
    - db.env
    volumes:
      - ./volumes/db:/data/db
    labels:
      traefik.docker.network: "inverseproxy_shared"
      traefik.enable: "true"
      traefik.frontend.passHostHeader: "true"
      traefik.port: "80"
      traefik.www.frontend.rule: "Host:inventaires.db.lachouettecoop.fr"

  api:
    image: inventory-coop
    restart: unless-stopped
    build:
      context: .
    env_file:
      - api.env
    environment:
      STATIC_PATH: /app/client/dist/static
    ports:
      - 8000:80/tcp
    depends_on:
      - db
    labels:
      traefik.docker.network: "inverseproxy_shared"
      traefik.enable: "true"
      traefik.frontend.passHostHeader: "true"
      traefik.port: "80"
      traefik.www.frontend.rule: "Host:inventaires.lachouettecoop.fr"